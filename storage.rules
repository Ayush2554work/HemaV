rules_version = '2';

// HemaV Firebase Storage Security Rules
// Controls access to profile pictures and scan images

service firebase.storage {
  match /b/{bucket}/o {

    // ======= PROFILE PICTURES =======
    // Users can upload/read their own profile picture
    match /profile_pictures/{userId}.jpg {
      allow read: if request.auth != null;  // Anyone can view profile pics
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 5 * 1024 * 1024  // Max 5MB
                   && request.resource.contentType.matches('image/.*');
    }

    // ======= SCAN IMAGES =======
    // Users can upload scan images to their own folder
    // Images are also accessible via download URLs in training_data
    match /scans/{userId}/{scanId}/{fileName} {
      allow read: if request.auth != null;  // Download URLs are shared for training
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 10 * 1024 * 1024  // Max 10MB per image
                   && request.resource.contentType.matches('image/.*');
    }
  }
}
